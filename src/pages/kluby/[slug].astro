---
import BaseLayout from "../../layouts/BaseLayout.astro";
import ContentWrapper from "../../components/shared/ContentWrapper.astro";
import SanityImage from "../../components/shared/SanityImage.astro";
import PortableText from "../../components/shared/PortableText.astro";
import { fetchClub } from "../../api/clubsPage/fetchClub/query";
import { fetchClubSlugs } from "../../api/clubsPage/fetchClubSlugs/query";

export async function getStaticPaths() {
  const slugs = await fetchClubSlugs();

  return slugs.map((item) => ({
    params: { slug: item.slug },
  }));
}

const { slug } = Astro.params;

if (!slug) {
  throw new Error("Slug is required");
}

const club = await fetchClub(slug);

if (!club) {
  return Astro.redirect("/404");
}
---

<BaseLayout
  pageTitle={club.title}
  seo={club.seo}
>
  <section>
    <ContentWrapper columnFlex gapResponsive>
      <h2>Klub<br>{club.title}</h2>

      <div class="club-description">

        <div class="paragraphs">
          {club.description && (
            <PortableText value={club.description} />
          )}
        </div>

        <div class="image-wrapper">
          {club.partner?.partnerImage ? (
            <SanityImage
              image={club.partner.partnerImage}
              alt={club.partner.partnerImage.alt || club.title || "Logo partnera"}
              widths={[400, 800, 1200]}
              sizes="(max-width: 768px) 100vw, 80vw"
              loading="eager"
            />
          ) : club.image ? (
            <SanityImage
              image={club.image}
              alt={club.image.alt || club.title || "ZdjÄ™cie klubu"}
              widths={[400, 800, 1200]}
              sizes="(max-width: 768px) 100vw, 80vw"
              loading="eager"
            />
          ) : null}
        </div>
      </div>

    </ContentWrapper>
  </section>
</BaseLayout>

<style>
  .club-description {
    display: flex;
    align-items: center;
    gap: 2rem;
    width: 100%;
  }

  .club-description > div {
    display: flex;
    flex: 1;
  }

  .paragraphs {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .image-wrapper {
    border: 10px solid var(--primary-color-light);
    border-radius: 1.25rem;
    overflow: hidden;
    height: 100%;
  }

  .image-wrapper > img {
    display: block;
    object-fit: cover;
    width: 100%;
    height: 100%;
  }

  .description-container :global(p) {
    line-height: 1.6;
    margin-bottom: 1rem;
  }

  .description-container :global(h1),
  .description-container :global(h2),
  .description-container :global(h3),
  .description-container :global(h4) {
    margin-top: 2rem;
    margin-bottom: 1rem;
  }

  .description-container :global(ul),
  .description-container :global(ol) {
    margin-left: 1.5rem;
    margin-bottom: 1rem;
  }

  .description-container :global(a) {
    color: var(--primary-color);
    text-decoration: underline;
  }

  .description-container :global(a:hover) {
    text-decoration: none;
  }

  @media only screen and (max-width: 768px) {
    .description-container {
      padding: 1.5rem;
    }
    .club-description {
      flex-direction: column-reverse;
    }
  }
</style>
